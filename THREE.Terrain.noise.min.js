/**
 * THREE.Terrain.js 1.0.0-19042014
 *
 * @author Isaac Sukin (http://www.isaacsukin.com/)
 * @license MIT
 */

!function(a){function b(a,b,c){this.x=a,this.y=b,this.z=c}function c(a){return a*a*a*(a*(6*a-15)+10)}function d(a,b,c){return(1-c)*a+c*b}var e=a.noise={};b.prototype.dot2=function(a,b){return this.x*a+this.y*b},b.prototype.dot3=function(a,b,c){return this.x*a+this.y*b+this.z*c};var f=[new b(1,1,0),new b(-1,1,0),new b(1,-1,0),new b(-1,-1,0),new b(1,0,1),new b(-1,0,1),new b(1,0,-1),new b(-1,0,-1),new b(0,1,1),new b(0,-1,1),new b(0,1,-1),new b(0,-1,-1)],g=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],h=new Array(512),i=new Array(512);e.seed=function(a){a>0&&1>a&&(a*=65536),a=Math.floor(a),256>a&&(a|=a<<8);for(var b=0;256>b;b++){var c;c=1&b?g[b]^255&a:g[b]^a>>8&255,h[b]=h[b+256]=c,i[b]=i[b+256]=f[c%12]}},e.seed(Math.random());var j=.5*(Math.sqrt(3)-1),k=(3-Math.sqrt(3))/6,l=1/3,m=1/6;e.simplex=function(a,b){var c,d,e,f=(a+b)*j,g=Math.floor(a+f),l=Math.floor(b+f),m=(g+l)*k,n=a-g+m,o=b-l+m,p,q;n>o?(p=1,q=0):(p=0,q=1);var r=n-p+k,s=o-q+k,t=n-1+2*k,u=o-1+2*k;g&=255,l&=255;var v=i[g+h[l]],w=i[g+p+h[l+q]],x=i[g+1+h[l+1]],y=.5-n*n-o*o;0>y?c=0:(y*=y,c=y*y*v.dot2(n,o));var z=.5-r*r-s*s;0>z?d=0:(z*=z,d=z*z*w.dot2(r,s));var A=.5-t*t-u*u;return 0>A?e=0:(A*=A,e=A*A*x.dot2(t,u)),70*(c+d+e)},e.perlin=function(a,b){var e=Math.floor(a),f=Math.floor(b);a-=e,b-=f,e=255&e,f=255&f;var g=i[e+h[f]].dot2(a,b),j=i[e+h[f+1]].dot2(a,b-1),k=i[e+1+h[f]].dot2(a-1,b),l=i[e+1+h[f+1]].dot2(a-1,b-1),m=c(a);return d(d(g,k,m),d(j,l,m),c(b))}}(this),THREE.Terrain=function(a){var b={easing:THREE.Terrain.NoEasing,heightmap:THREE.Terrain.DiamondSquare,material:null,maxHeight:100,maxVariation:12,minHeight:-100,optimization:THREE.Terrain.NONE,perlinScale:.4,useBufferGeometry:!0,xSegments:63,xSize:1024,ySegments:63,ySize:1024};a=a||{};for(var c in b)b.hasOwnProperty(c)&&(a[c]="undefined"==typeof a[c]?b[c]:a[c]);a.unit=.5*(a.xSize/(a.xSegments+1)+a.ySize/(a.ySegments+1)),a.material=a.material||new THREE.MeshBasicMaterial({color:15623731});var d=new THREE.Scene,e=new THREE.Mesh(new THREE.PlaneGeometry(a.xSize,a.ySize,a.xSegments,a.ySegments),a.material);return e.rotation.x=-.5*Math.PI,a.heightmap instanceof HTMLCanvasElement||a.heightmap instanceof Image?THREE.Terrain.fromHeightmap(e.geometry.vertices,a):"function"==typeof a.heightmap?a.heightmap(e.geometry.vertices,a):window.console&&console.warn&&console.warn("An invalid value was passed for `options.heightmap`: "+a.heightmap),e.geometry.verticesNeedUpdate=!0,e.geometry.normalsNeedUpdate=!0,e.geometry.computeBoundingSphere(),a.useBufferGeometry&&(e.geometry=THREE.BufferGeometryUtils.fromGeometry(e.geometry)),d.add(e),d},THREE.Terrain.NONE=0,THREE.Terrain.GEOMIPMAP=1,THREE.Terrain.GEOCLIPMAP=2,THREE.Terrain.NoEasing=function(a){return a},THREE.Terrain.EaseInOut=function(a){return a*a*(3-2*a)},THREE.Terrain.InEaseOut=function(a){var b=2*a-1;return.5*b*b*b+.5},function(){function a(a,b){var c=(a+"").match(/^[\s\S]*?\/\*!?\s*([\s\S]+?)\s*\*\/$/m)[1];if("undefined"!=typeof b)for(var d=Object.keys(b).sort(function(a,b){return b.length-a.length}),e=0,f=d.length;f>e;e++){var g=d[e],h=b[g];c=c.split("$"+g).join(h)}return c}function b(){/*!
    varying vec2 vUv;
    varying vec3 vPosition;
    void main( void ) {
        vUv = uv;
        vPosition = position;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(vPosition, 1);
    }
    */
var a}function c(){/*!
    $fog_pars_fragment
    varying vec2 vUv;
    varying vec3 vPosition;
$declareTextures
    void main() {
        vec4 color = texture2D( texture_0, vUv ); // base
$assignTextures
        gl_FragColor = color;
        $fog_fragment
    }
    */
var a}THREE.Terrain.generateBlendedMaterial=function(d,e){var f={},g="",h="";e&&e.fog&&(f={fogColor:{type:"c",value:e.fog.color},fogDensity:{type:"c",value:e.fog.density},fogNear:{type:"f",value:e.fog.near},fogFar:{type:"f",value:e.fog.far}});for(var i=0,j=d.length;j>i;i++)if(d[i].wrapS=d[i].wrapT=THREE.RepeatWrapping,f["texture_"+i]={type:"t",value:d[i].texture},h+="    uniform sampler2D texture_"+i+";\n",0!==i){var k=d[i].levels,l=d[i].glsl,m="undefined"!=typeof k;if(m){k[1]-k[0]<1&&(k[0]-=1),k[3]-k[2]<1&&(k[3]+=1);for(var n=0;n<k.length;n++){var o=k[n];k[n]=o|0===o?o+".0":o+""}}g+="        color = mix( texture2D( texture_"+i+", vUv ), color, max(min("+(m?"1.0 - smoothstep("+k[0]+", "+k[1]+", vPosition.z) + smoothstep("+k[2]+", "+k[3]+", vPosition.z)":l)+", 1.0), 0.0));\n"}return new THREE.ShaderMaterial({uniforms:f,vertexShader:a(b),fragmentShader:a(c,{assignTextures:g,declareTextures:h,fog_fragment:e&&e.fog?THREE.ShaderChunk.fog_fragment:"",fog_pars_fragment:e&&e.fog?THREE.ShaderChunk.fog_pars_fragment:""}),fog:!0})}}(),THREE.Terrain.fromHeightmap=function(a,b){var c=document.createElement("canvas"),d=c.getContext("2d"),e=b.ySegments+1,f=b.xSegments+1,g=b.maxHeight-b.minHeight;c.width=f,c.height=e,d.drawImage(b.heightmap,0,0,c.width,c.height);for(var h=d.getImageData(0,0,c.width,c.height).data,i=0;e>i;i++)for(var j=0;f>j;j++){var k=i*f+j,l=4*k;a[k].z=(h[l]+h[l+1]+h[l+2])/765*g}},THREE.Terrain.toHeightmap=function(a,b){var c=b.heightmap instanceof HTMLCanvasElement?b.heightmap:document.createElement("canvas"),d=c.getContext("2d"),e=b.ySegments+1,f=b.xSegments+1,g=b.maxHeight-b.minHeight;c.width=f,c.height=e;for(var h=d.createImageData(c.width,c.height),i=h.data,j=0;e>j;j++)for(var k=0;f>k;k++){var l=j*f+k,m=4*l;i[m]=i[m+1]=i[m+2]=Math.round((a[l].z-b.minHeight)/g*255),i[m+3]=255}return d.putImageData(h,0,0),c},THREE.Terrain.Corner=function(a,b){for(var c=b.maxVariation,d=.5*c,e=0,f=b.xSegments+1;f>e;e++)for(var g=0;g<b.ySegments+1;g++){var h=g*f+e,i=(g-1)*f+e,j=g*f+e-1,k=0>i?a[h].z:a[i].z,l=0>j?a[h].z:a[j].z,m=Math.random(),n=.5*(.2>m?k:.4>m?l:k+l),o=b.easing(Math.random())*c-d;a[h].z+=THREE.Math.clamp(n+o,b.minHeight,b.maxHeight)}},THREE.Terrain.DiamondSquare=function(a,b){var c=Math.max(b.xSegments,b.ySegments)+1,d;for(d=1;Math.pow(2,d)<c;d++);c=Math.pow(2,d);var e=c+1,f=[],g=b.maxHeight-b.minHeight,h,i,j=b.xSegments+1,k=b.ySegments+1;for(h=0;c>=h;h++)for(f[h]=[],i=0;c>=i;i++)f[h][i]=0;for(var l=c;l>=2;l/=2){var m=Math.round(.5*l),n=Math.round(l),o,p,q,r,s;for(g/=2,o=0;c>o;o+=n)for(p=0;c>p;p+=n)r=b.easing(Math.random())*g*2-g,q=f[o][p]+f[o+n][p]+f[o][p+n]+f[o+n][p+n],q*=.25,f[o+m][p+m]=q+r;for(o=0;c>o;o+=m)for(p=(o+m)%l;c>p;p+=l)r=b.easing(Math.random())*g*2-g,q=f[(o-m+e)%e][p]+f[(o+m)%e][p]+f[o][(p+m)%e]+f[o][(p-m+e)%e],q*=.25,q+=r,f[o][p]=q,0===o&&(f[c][p]=q),0===p&&(f[o][c]=q)}for(h=0;j>h;h++)for(i=0;k>i;i++)a[i*j+h].z+=THREE.Math.clamp(f[h][i],b.minHeight,b.maxHeight)},window.noise&&window.noise.perlin&&(THREE.Terrain.Perlin=function(a,b){noise.seed(Math.random());for(var c=b.maxHeight-.5*b.minHeight,d=(Math.min(b.xSegments,b.ySegments)+1)*b.perlinScale,e=0,f=b.xSegments+1;f>e;e++)for(var g=0,h=b.ySegments+1;h>g;g++)a[g*f+e].z+=THREE.Math.clamp(b.easing(noise.perlin(e/d,g/d))*c,b.minHeight,b.maxHeight)}),window.noise&&window.noise.simplex&&(THREE.Terrain.Simplex=function(a,b){noise.seed(Math.random());for(var c=.5*(b.maxHeight-b.minHeight),d=(Math.min(b.xSegments,b.ySegments)+1)*b.perlinScale*2,e=0,f=b.xSegments+1;f>e;e++)for(var g=0,h=b.ySegments+1;h>g;g++)a[g*f+e].z+=THREE.Math.clamp(b.easing(noise.simplex(e/d,g/d))*c,b.minHeight,b.maxHeight)}),THREE.Terrain.MultiPass=function(a,b,c){for(var d=.1,e=b.maxHeight,f=b.minHeight,g=0,h=c.length;h>g;g++){if(0!==g){var i="undefined"==typeof c[g].granularity?1:c[g].granularity,j=.5*(b.maxHeight-b.minHeight)*d*i;b.maxHeight-=j,b.minHeight+=j}c[g].method(a,b)}b.maxHeight=e,b.minHeight=f},THREE.Terrain.PerlinDiamond=function(a,b){THREE.Terrain.MultiPass(a,b,[{method:THREE.Terrain.Perlin},{method:THREE.Terrain.DiamondSquare,granularity:-2}])},THREE.Terrain.SimplexCorner=function(a,b){THREE.Terrain.MultiPass(a,b,[{method:THREE.Terrain.Simplex},{method:THREE.Terrain.Corner,granularity:2}])};
//# sourceMappingURL=THREE.Terrain.noise.min.map