/**
 * THREE.Terrain.js 1.0.0-06052014
 *
 * @author Isaac Sukin (http://www.isaacsukin.com/)
 * @license MIT
 */

THREE.Terrain=function(a){var b={after:null,easing:THREE.Terrain.Linear,heightmap:THREE.Terrain.DiamondSquare,material:null,maxHeight:100,maxVariation:12,minHeight:-100,optimization:THREE.Terrain.NONE,perlinScale:.4,useBufferGeometry:!0,xSegments:63,xSize:1024,ySegments:63,ySize:1024};a=a||{};for(var c in b)b.hasOwnProperty(c)&&(a[c]="undefined"==typeof a[c]?b[c]:a[c]);a.material=a.material||new THREE.MeshBasicMaterial({color:15623731});var d=new THREE.Object3D;d.rotation.x=-.5*Math.PI;var e=new THREE.Mesh(new THREE.PlaneGeometry(a.xSize,a.ySize,a.xSegments,a.ySegments),a.material);return a.heightmap instanceof HTMLCanvasElement||a.heightmap instanceof Image?THREE.Terrain.fromHeightmap(e.geometry.vertices,a):"function"==typeof a.heightmap?a.heightmap(e.geometry.vertices,a):window.console&&console.warn&&console.warn("An invalid value was passed for `options.heightmap`: "+a.heightmap),THREE.Terrain.Clamp(e.geometry.vertices,a),"function"==typeof a.after&&a.after(e.geometry.vertices,a),e.geometry.verticesNeedUpdate=!0,e.geometry.normalsNeedUpdate=!0,e.geometry.computeBoundingSphere(),a.useBufferGeometry&&(e.geometry=THREE.BufferGeometryUtils.fromGeometry(e.geometry)),d.add(e),d},THREE.Terrain.NONE=0,THREE.Terrain.GEOMIPMAP=1,THREE.Terrain.GEOCLIPMAP=2,THREE.Terrain.POLYGONREDUCTION=3,THREE.Terrain.generateBlendedMaterial=function(a){for(var b=THREE.UniformsUtils.merge([THREE.ShaderLib.lambert.uniforms]),c="",d="",e=0,f=a.length;f>e;e++)if(a[e].wrapS=a[e].wrapT=THREE.RepeatWrapping,a[e].needsUpdate=!0,b["texture_"+e]={type:"t",value:a[e].texture},c+="uniform sampler2D texture_"+e+";\n",0!==e){var g=a[e].levels,h=a[e].glsl,i="undefined"!=typeof g;if(i){g[1]-g[0]<1&&(g[0]-=1),g[3]-g[2]<1&&(g[3]+=1);for(var j=0;j<g.length;j++){var k=g[j];g[j]=k|0===k?k+".0":k+""}}var l=i?"1.0 - smoothstep("+g[0]+", "+g[1]+", vPosition.z) + smoothstep("+g[2]+", "+g[3]+", vPosition.z)":h;d+="        color = mix( texture2D( texture_"+e+", MyvUv ), color, max(min("+l+", 1.0), 0.0));\n"}var m={fog:!0,lights:!0,uniforms:b,vertexShader:THREE.ShaderLib.lambert.vertexShader.replace("void main() {","varying vec2 MyvUv;\nvarying vec3 vPosition;\nvoid main() {\nMyvUv = uv;\nvPosition = position;"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","    varying vec3 vLightBack;","#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,c,"varying vec2 MyvUv;","varying vec3 vPosition;","void main() {","    vec4 color = texture2D( texture_0, MyvUv ); // base",d,"    gl_FragColor = color;",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"    #ifdef DOUBLE_SIDED","        if ( gl_FrontFacing )","            gl_FragColor.xyz *= vLightFront;","        else","            gl_FragColor.xyz *= vLightBack;","    #else","        gl_FragColor.xyz *= vLightFront;","    #endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")};return new THREE.ShaderMaterial(m)},THREE.Terrain.fromHeightmap=function(a,b){var c=document.createElement("canvas"),d=c.getContext("2d"),e=b.ySegments+1,f=b.xSegments+1,g=b.maxHeight-b.minHeight;c.width=f,c.height=e,d.drawImage(b.heightmap,0,0,c.width,c.height);for(var h=d.getImageData(0,0,c.width,c.height).data,i=0;e>i;i++)for(var j=0;f>j;j++){var k=i*f+j,l=4*k;a[k].z=(h[l]+h[l+1]+h[l+2])/765*g}},THREE.Terrain.toHeightmap=function(a,b){var c=b.heightmap instanceof HTMLCanvasElement?b.heightmap:document.createElement("canvas"),d=c.getContext("2d"),e=b.ySegments+1,f=b.xSegments+1,g=b.maxHeight-b.minHeight;c.width=f,c.height=e;for(var h=d.createImageData(c.width,c.height),i=h.data,j=0;e>j;j++)for(var k=0;f>k;k++){var l=j*f+k,m=4*l;i[m]=i[m+1]=i[m+2]=Math.round((a[l].z-b.minHeight)/g*255),i[m+3]=255}return d.putImageData(h,0,0),c},THREE.Terrain.heightmapArray=function(a,b){var c=new Array((b.xSegments+1)*(b.ySegments+1)),d=c.length,e;for(e=0;d>e;e++)c[e]={z:0};for(b.minHeight=b.minHeight||0,b.maxHeight="undefined"==typeof b.maxHeight?1:b.maxHeight,a(c,b),THREE.Terrain.Clamp(c,b,!0),e=0;d>e;e++)c[e]=c[e].z;return c},THREE.Terrain.Smooth=function(a,b){for(var c=new Array(a.length),d=0,e=b.xSegments+1;e>d;d++)for(var f=0;f<b.ySegments+1;f++){for(var g=0,h=-1;1>=h;h++)for(var i=-1;1>=i;i++){var j=(f+h)*e+d+i;"undefined"!=typeof a[j]&&(g+=a[j].z)}c[f*e+d]=g/9}for(var k=0,l=a.length;l>k;k++)a[k].z=c[k]},THREE.Terrain.Edges=function(a,b,c,d,e){var f=Math.floor(d/(b.xSize/b.xSegments))||1,g=Math.floor(d/(b.ySize/b.ySegments))||1,h=c?b.maxHeight:b.minHeight,i=c?Math.max:Math.min,j=b.xSegments+1,k=b.ySegments+1,l,m,n,o,p,q;for(e=e||THREE.Terrain.EaseInOut,l=0;j>l;l++)for(m=0;g>m;m++)n=e(1-m/g),o=h*n,p=m*j+l,q=(b.ySegments-m)*j+l,a[p].z=i(a[p].z,(h-a[p].z)*n+a[p].z),a[q].z=i(a[q].z,(h-a[q].z)*n+a[q].z);for(l=0;k>l;l++)for(m=0;f>m;m++)n=e(1-m/f),o=h*n,p=l*j+m,q=(b.ySegments-l)*j+(b.xSegments-m),a[p].z=i(a[p].z,(h-a[p].z)*n+a[p].z),a[q].z=i(a[q].z,(h-a[q].z)*n+a[q].z)},THREE.Terrain.DiamondSquare=function(a,b){var c=Math.max(b.xSegments,b.ySegments)+1,d;for(d=1;Math.pow(2,d)<c;d++);c=Math.pow(2,d);var e=c+1,f=[],g=b.maxHeight-b.minHeight,h,i,j=b.xSegments+1,k=b.ySegments+1;for(h=0;c>=h;h++)for(f[h]=[],i=0;c>=i;i++)f[h][i]=0;for(var l=c;l>=2;l/=2){var m=Math.round(.5*l),n=Math.round(l),o,p,q,r,s;for(g/=2,o=0;c>o;o+=n)for(p=0;c>p;p+=n)r=Math.random()*g*2-g,q=f[o][p]+f[o+n][p]+f[o][p+n]+f[o+n][p+n],q*=.25,f[o+m][p+m]=q+r;for(o=0;c>o;o+=m)for(p=(o+m)%l;c>p;p+=l)r=Math.random()*g*2-g,q=f[(o-m+e)%e][p]+f[(o+m)%e][p]+f[o][(p+m)%e]+f[o][(p-m+e)%e],q*=.25,q+=r,f[o][p]=q,0===o&&(f[c][p]=q),0===p&&(f[o][c]=q)}for(h=0;j>h;h++)for(i=0;k>i;i++)a[i*j+h].z+=f[h][i]},window.noise&&window.noise.perlin&&(THREE.Terrain.Perlin=function(a,b){noise.seed(Math.random());for(var c=b.maxHeight-.5*b.minHeight,d=(Math.min(b.xSegments,b.ySegments)+1)*b.perlinScale,e=0,f=b.xSegments+1;f>e;e++)for(var g=0,h=b.ySegments+1;h>g;g++)a[g*f+e].z+=noise.perlin(e/d,g/d)*c}),window.noise&&window.noise.simplex&&(THREE.Terrain.Simplex=function(a,b){noise.seed(Math.random());for(var c=.5*(b.maxHeight-b.minHeight),d=(Math.min(b.xSegments,b.ySegments)+1)*b.perlinScale*2,e=0,f=b.xSegments+1;f>e;e++)for(var g=0,h=b.ySegments+1;h>g;g++)a[g*f+e].z+=noise.simplex(e/d,g/d)*c}),THREE.Terrain.MultiPass=function(a,b,c){for(var d=b.maxHeight,e=b.minHeight,f=0,g=c.length;g>f;f++){if(0!==f){var h="undefined"==typeof c[f].granularity?1:c[f].granularity,i=.5*(b.maxHeight-b.minHeight)*h;b.maxHeight-=i,b.minHeight+=i}c[f].method(a,b)}b.maxHeight=d,b.minHeight=e},THREE.Terrain.Clamp=function(a,b,c){var d=1/0,e=-1/0,f=a.length,g;for(b.easing=b.easing||THREE.Terrain.Linear,g=0;f>g;g++)a[g].z<d&&(d=a[g].z),a[g].z>e&&(e=a[g].z);var h=e-d,i="undefined"==typeof b.maxHeight?e:b.maxHeight,j="undefined"==typeof b.minHeight?d:b.minHeight,k=c?i:i>e?e:i,l=c?j:d>j?d:j,m=k-l;for(g=0;f>g;g++)a[g].z=b.easing((a[g].z-d)/h)*m+j},THREE.Terrain.Linear=function(a){return a},THREE.Terrain.EaseIn=function(a){return a*a},THREE.Terrain.EaseOut=function(a){return-a*(a-2)},THREE.Terrain.EaseInOut=function(a){return a*a*(3-2*a)},THREE.Terrain.InEaseOut=function(a){var b=2*a-1;return.5*b*b*b+.5},THREE.Terrain.Perlin&&(THREE.Terrain.PerlinDiamond=function(a,b){THREE.Terrain.MultiPass(a,b,[{method:THREE.Terrain.Perlin},{method:THREE.Terrain.DiamondSquare,granularity:-.2}])}),THREE.Terrain.ScatterMeshes=function(a,b){if(!b.mesh)return console.error("options.mesh is required for THREE.Terrain.ScatterMeshes but was not passed"),void 0;if(a instanceof THREE.BufferGeometry)return console.warn("The terrain mesh is using BufferGeometry but THREE.Terrain.ScatterMeshes can only work with Geometry."),void 0;b.scene||(b.scene=new THREE.Object3D);var c={spread:.025,sizeVariance:.1,randomness:Math.random,x:0,y:0,w:0,h:0};for(var d in c)c.hasOwnProperty(d)&&(b[d]="undefined"==typeof b[d]?c[d]:b[d]);var e="number"==typeof b.spread,f,g,h=2*b.sizeVariance,i=a.vertices,j=[];e&&(f=b.randomness(),g="number"==typeof f?Math.random:function(a){return f[a]}),a.computeFaceNormals();for(var k=b.y,l=2*b.w;l>k;k++)for(var m=b.x,n=b.h;n>m;m++){var o=m*l+k,p=a.faces[o];if(e?g(o)<b.spread:b.spread(i[p.a],o)){var q=b.mesh.clone();q.position.copy(i[p.a]).add(i[p.b]).add(i[p.c]).divideScalar(3);var r=q.position.clone().add(p.normal);if(q.lookAt(q.position.clone().add(p.normal)),q.rotation.x+=.5*Math.PI,b.sizeVariance){var s=Math.random()*h-b.sizeVariance;q.scale.x=q.scale.z=1+s,q.scale.y+=s}j.push(q)}}var t,u;if(b.mesh.geometry instanceof THREE.Geometry){var v=new THREE.Geometry;for(t=0,u=j.length;u>t;t++){var w=j[t];w.updateMatrix(),v.merge(w.geometry,w.matrix)}b.scene.add(new THREE.Mesh(v,b.mesh.material))}else for(t=0,u=j.length;u>t;t++)b.scene.add(j[t]);return b.scene},THREE.Terrain.ScatterHelper=function(a,b,c,d){c=c||1,d=d||.25,b.perlinScale=b.perlinScale||.4,b.maxVariation=b.maxVariation||12;var e=b.xSegments;b.xSegments*=2;var f=THREE.Terrain.heightmapArray(a,b);b.xSegments=e;for(var g=0,h=f.length;h>g;g++)(g%c||Math.random()>d)&&(f[g]=1);return function(){return f}};
//# sourceMappingURL=THREE.Terrain.min.map